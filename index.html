<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Tropico island - WebGL</title>
    <link rel="stylesheet" href="index.css" />
</head>
<body>
<!--SHADERS-->
<script id="x-shader" type="nojs">
    attribute vec4 a_position;
    uniform vec4 u_color;
    attribute vec3 a_normal;
    attribute vec2 a_texture;

    uniform mat4 u_matrix;
    uniform mat4 u_worldInverseTranspose;
    varying vec4 v_color;
    varying vec3 v_normal;
    varying vec2 v_texture;

    uniform vec3 u_directionalLightDirection;
    uniform vec4 u_directionalLightColor;
    uniform vec3 u_pointLightPosition;
    uniform vec4 u_pointLightColor;


    vec3 ambient = vec3(0.2, 0.2, 0.2);

    varying vec3 v_LightWeighting;

    void main() {

        gl_Position =u_matrix * a_position;

        vec3 proper_normal = mat3(u_worldInverseTranspose) * normalize(a_normal);
        float directionalLightWeighting = max(dot(normalize(proper_normal), normalize(u_directionalLightDirection)), 0.0);
        vec3 pointLightDirectionForVertex = normalize(u_pointLightPosition - a_position.xyz);
        float pointDirectionalLightWeighting = max(dot(normalize(proper_normal), pointLightDirectionForVertex), 0.0);

        v_LightWeighting = ambient + vec3(u_directionalLightColor) * directionalLightWeighting + vec3(u_pointLightColor) * pointDirectionalLightWeighting;


        // Pass the color to the fragment shader.
        v_color = u_color;
        v_texture = a_texture;
    }
</script>

<script id="x-fragment-shader" type="nojs">
    precision mediump float;

    // Passed in from the vertex shader.
    varying vec4 v_color;
    varying vec3 v_LightWeighting;
    varying vec2 v_texture;

    uniform sampler2D u_sampler;
    uniform int u_usesTexture;
    void main() {
        if(u_usesTexture == 0) {
            gl_FragColor = vec4(vec3(v_color) * v_LightWeighting, 1.0);
        } else {
            vec2 flipped_texcoord = vec2(v_texture.x, 1.0 - v_texture.y);
            gl_FragColor = vec4(vec3(texture2D(u_sampler, flipped_texcoord.xy)) * v_LightWeighting, 1.0);
        }

    }
</script>

<!--MAIN CANVAS-->
<div class="debug-info" style="display: block;">
    <span>FPS:</span> <span id="frames"></span> <br>
    <span>Camera info: </span>
    <span id="camera-info"></span>
    <br>
    <span>Sphere info</span>
    <span id="sphere-info"></span>
</div>
<canvas id="main-canvas"></canvas>


<script src="src/core/rgbColor.js"></script>
<script src="src/core/texture.js"></script>
<script src="src/sceneObjects/sceneObject.js"></script>
<!-- LIBRARIES -->
<script src="lib/gl-matrix.js"></script>
<script src="lib/webgl-obj-loader.js"></script>

<!-- SOURCES -->
<script src="src/camera.js"></script>
<script src="src/materials/phong.js"></script>
<script src="src/lighting/directionalLight.js"></script>
<script src="src/lighting/pointLight.js"></script>
<script src="src/sceneObjects/meshObject.js"></script>
<script src="src/sceneObjects/sphere.js"></script>
<script src="src/sceneObjects/plain.js"></script>
<script src="src/utils-webgl.js"></script>
<script src="src/drawing-utils.js"></script>
<script src="index.js"></script>
</body>
</html>